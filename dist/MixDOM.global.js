!function(){'use strict';var e;(e=>{e[e.never=-3]='never',e[e.always=-2]='always',e[e.deep=-1]='deep',e[e.changed=0]='changed',e[e.shallow=1]='shallow',e[e.double=2]='double'})(e||(e={}));const t={COMPLEX_DOM_PROPS:{style:!0,data:!0},range(e,t,n=1){null==t&&([t,e]=[e,0]);const s=[];if(t<e)for(let o=e-1;o>=t;o-=n)s.push(o);else for(let o=e;o<t;o+=n)s.push(o);return s},decapitalize:(e,t='')=>e.replace(/([A-Z])/g,t+'$1').toLowerCase(),buildRecordable(e){if(e.constructor===Object)return e;const t={};for(const n of e)t[n]=!0;return t},callWithTimeout(e,t,n,s,o){null!==n&&void 0!==o&&(clearTimeout(n),n=null);const r=void 0===o?s:o;return null===r?t.call(e):null===n&&(n=setTimeout((()=>t.call(e)),r)),n},cleanDOMProps(e,n){const s=n?Object.assign({},e):e;return s.class&&(s.className=s.className?s.class+' '+s.className:s.class),delete s.class,'string'==typeof s.style&&(s.style=t.cleanDOMStyle(s.style)),s},cleanDOMStyle(e){const t=e.replace(/\/\*(.|\s)*?\*\//g,' ').replace(/\s+/g,' ').trim();if(!t)return{};const n={},s=t.split(';').map((e=>e.split(':').map((e=>e&&e.trim()))));for(const[e,t]of s)e&&(n[e.replace(/\W+\w/g,(e=>e.slice(-1).toUpperCase()))]=t);return n},cleanDOMClass(...e){const n={};for(const s of e)s&&t.collectNamesTo(s,n,' ');return Object.keys(n).join(' ')},collectNamesTo(e,t,n=''){switch(typeof e){case'string':if(n)for(const s of e.split(n))s&&(t[s]=!0);else t[e]=!0;break;case'object':if(e.constructor===Object)for(const n in e)n&&e[n]&&(t[n]=!0);else for(const s of e)if(s&&'string'==typeof s)if(n)for(const e of s.split(n))e&&(t[e]=!0);else t[s]=!0}},getClassNameDiffs(e,t){if((e=e||'')===(t=t||''))return null;const n=e.split(' '),s=t.split(' '),o={};let r=null;if(n)for(const e of n)!e||s&&-1!==s.indexOf(e)||(o[e]=r=!1);if(s)for(const e of s)!e||n&&-1!==n.indexOf(e)||(o[e]=r=!0);return null!==r?o:null},getDictionaryDiffs(e,t){const n={};let s=!1;for(const o in e){void 0!==e[o]&&void 0===t[o]&&(n[o]=void 0,s=!0)}for(const o in t){const r=t[o];e[o]!==r&&(n[o]=r,s=!0)}return s?n:null},equalDOMProps(e,n){for(const s in t.COMPLEX_DOM_PROPS)if(e[s]){if(!n[s])return!1;const t=e[s],o=n[s];if(t!==o){for(const e in o)if(t[e]!==o[e])return!1;for(const e in t)if(void 0===o[e]&&void 0!==t[e])return!1}}else if(n[s])return!1;for(const s in n)if(e[s]!==n[s]&&!t.COMPLEX_DOM_PROPS[s])return!1;for(const s in e)if(void 0===n[s]&&void 0!==e[s]&&!t.COMPLEX_DOM_PROPS[s])return!1;return!0},equalDictionariesBy(n,s,o){var r;const i=!n||!s;for(const a in o){const d=o[a],l='number'==typeof d?d:null!==(r=e[d])&&void 0!==r?r:0;if(l<-1){if(-2===l)return!1}else{if(-2===l)return!1;if(i)return!n&&!s;if(0===l){if(n[a]!==s[a])return!1}else if(!t.areEqual(n[a],s[a],l))return!1}}return!0},areEqual(e,n,s=-1){if(e===n)return!0;if(e&&s&&'object'==typeof e){if(!n||'object'!=typeof n)return!1;const o=e.constructor;if(o!==n.constructor)return!1;s--;let r=!1;switch(o){case Object:break;case Array:r=!0;break;case Set:r=!0,e=[...e],n=[...n];break;case Map:if(e.size!==n.size)return!1;for(const[o,r]of e){if(!n.has(o))return!1;if(s?!t.areEqual(n.get(o),r,s):n.get(o)!==r)return!1}return!0;default:const o=e.toString();'[object NodeList]'!==o&&'[object HTMLCollection]'!==o||(r=!0)}if(r){const o=e.length;if(o!==n.length)return!1;for(let r=0;r<o;r++)if(s?!t.areEqual(e[r],n[r],s):e[r]!==n[r])return!1}else{for(const o in n){if(!e.hasOwnProperty(o))return!1;if(s?!t.areEqual(e[o],n[o],s):e[o]!==n[o])return!1}for(const t in e)if(!n.hasOwnProperty(t))return!1}return!0}return!1},deepCopy(e,n=-1){if(!e||!n||'object'!=typeof e)return e;n--;let s=null;switch(e.constructor){case Object:break;case Array:s=e;break;case Set:return new Set(n?[...e].map((e=>t.deepCopy(e,n))):e);case Map:return new Map(n?[...e].map((([e,s])=>[t.deepCopy(e,n),t.deepCopy(s,n)])):e);default:const o=e.toString();'[object NodeList]'!==o&&'[object HTMLCollection]'!==o||(s=[...e])}if(s)return n?s.map((e=>t.deepCopy(e,n))):[...s];if(!n)return Object.assign({},e);const o=new e.constructor;for(const s in e)o[s]=t.deepCopy(e[s],n);return o}};var n=(e,t)=>{var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(n[s[o]]=e[s[o]])}return n};var s=(e,t)=>{var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(n[s[o]]=e[s[o]])}return n};function o(e,o=null,...i){const a=r.getMixDOMDefType(e);if(!a||o&&o._disable)return null;const d=[];let l=!1,c=0;for(const e of i){let t='string'==typeof e;if(e&&t&&l){d[c-1].domContent+=e;continue}const n=r.newDefFrom(e);n&&(c=d.push(n),l=t)}if('spread'===a)return function(e,t,s){var o;const{_key:i,_disable:a}=t,d=n(t,['_key','_disable']);let l=r.newDefFrom(e(d));if(!l)return null;const c={passes:[],withs:[]},u={MIX_DOM_DEF:'fragment',childDefs:[Object.assign({},l)],scopeType:'spread',spreadLinks:c,tag:null};null!=i&&(u.key=i),null!=a&&(u.disabled=a);let f,h=[u],p=!1,m=0;const g=!!s[0];for(;f=h[m];){if(m++,!f.childDefs[0])continue;let e=[];const t=f.childDefs;f.childDefs=[];for(const n of t){let t;if(n.spreadLinks){t=n,e=e.concat(n.spreadLinks.passes);for(const[e,t]of n.spreadLinks.withs){const n=e&&r.hasContentInDefs(e,g);t.props.hasContent=!!n,'maybe'===n&&c.withs.push([e,t])}}else if('pass'!==n.MIX_DOM_DEF||n.getStream){if(t=Object.assign({},n),e.push(t),'boundary'===n.MIX_DOM_DEF&&n.tag._WithContent&&!n.tag._WithContent.getStream&&null==(null===(o=t.props)||void 0===o?void 0:o.hasContent)){const e=r.hasContentInDefs(s,g);t.props=Object.assign({hasContent:!!e},t.props),'maybe'===e&&c.withs.push([s,t])}}else t={MIX_DOM_DEF:'fragment',tag:null,childDefs:[...s]},null!=n.key&&(t.key=n.key),p||'copy'===n.contentPassType?t.scopeType='spread-copy':(t.scopeType='spread-pass',p=!0),c.passes.push(t);f.childDefs.push(t)}h=e.concat(h.slice(m)),m=0}return u}(e,o||{},d);if('fragment'===a&&!d[0])return null;const u='dom'===a&&e||'boundary'===a&&e||'element'===a&&'_'||('content'===a?'':null),f={MIX_DOM_DEF:a,tag:u,childDefs:d},h=!!u;if('fragment'===f.MIX_DOM_DEF);else if(o){const{_key:e,_ref:n,_signals:r,_contexts:i,_disable:d}=o,l=s(o,['_key','_ref','_signals','_contexts','_disable']);if(null!=e&&(f.key=e),n){const e=[];if('Ref'===n.constructor.MIX_DOM_CLASS)e.push(n);else for(const t of n)t&&'Ref'===t.constructor.MIX_DOM_CLASS&&-1===e.indexOf(t)&&e.push(t);f.attachedRefs=e}r&&(f.attachedSignals=Object.assign({},r)),i&&'boundary'===a&&(f.attachedContexts=Object.assign({},i)),h&&(f.props='string'==typeof u?t.cleanDOMProps(l):l)}else h&&(f.props={});switch(f.MIX_DOM_DEF){case'portal':{const e=o||{};f.domPortal=e.container||null;break}case'element':{const e=o||{};f.domElement=e.element||null,f.domCloneMode=null!=e.cloneMode?'boolean'==typeof e.cloneMode?e.cloneMode?'deep':'':e.cloneMode:null,delete f.props.element,delete f.props.cloneMode;break}}return f}const r={newDefFrom(e){if(e&&'object'==typeof e){if('string'==typeof e.MIX_DOM_DEF)return e;if(e instanceof Node)return{MIX_DOM_DEF:'content',tag:'',childDefs:[],domContent:e};if('Host'===e.constructor.MIX_DOM_CLASS)return{MIX_DOM_DEF:'host',tag:null,host:e,key:e,childDefs:[]};if(Array.isArray(e)||e instanceof HTMLCollection||e instanceof NodeList){const t=[...e].map((e=>r.newDefFrom(e))).filter((e=>e));return t.length?{MIX_DOM_DEF:'fragment',tag:null,isArray:!0,childDefs:t}:null}e=String(e)}return null!=e?{MIX_DOM_DEF:'content',tag:'',domContent:e,childDefs:[]}:null},newAppliedDef(e,t){const n={MIX_DOM_DEF:e.MIX_DOM_DEF,tag:e.tag,childDefs:[],action:'mounted'};return null!=e.key&&(n.key=e.key),'fragment'===n.MIX_DOM_DEF?(e.isArray&&(n.isArray=!0),e.scopeType&&(n.scopeType=e.scopeType)):'pass'===n.MIX_DOM_DEF?e.getStream?(n.getStream=e.getStream,n.contentPass=e.contentPass||null):n.contentPass=e.contentPass||t||null:e.host&&(n.host=e.host),n},newContentPassDef(e,t){const n={MIX_DOM_DEF:'pass',tag:null,childDefs:[],contentPassType:t?'copy':'pass'};return null!=e?n.key=e:t||(n.key=r.ContentKey),n},newContentCopyDef:e=>r.newContentPassDef(e,!0),getMixDOMDefType(e){if('string'==typeof e)return'dom';const t=e.MIX_DOM_CLASS;if(!t)return'function'==typeof e?e.length>=2?'boundary':'spread':'';switch(t){case'Component':case'Stream':return'boundary';case'Fragment':case'Portal':case'Element':case'Host':return t.toLowerCase();default:return''}},hasContentInDefs(e,t){let n=!1;for(const s of e){if(s.disabled)continue;const e='fragment'===s.MIX_DOM_DEF?r.hasContentInDefs(s.childDefs,t):'pass'!==s.MIX_DOM_DEF||('function'==typeof t?t(s):t&&'maybe');if(e){if(!0===e)return!0;n='maybe'}}return n},ContentKey:{}},i={treeNodesWithin(e,t,n=0,s=!1,o=!1,r){const i=[];let a,d=[e],l=0;const c=e.boundary;for(;a=d[l];)if(l++,!a.boundary||null!==a.boundary.isMounted){if((!t||t[a.type])&&(!r||r(a))){const e=i.push(a);if(n&&e>=n)return i}a.boundary&&!s&&a.boundary!==c||('host'!==a.type||o)&&a.children[0]&&(d=a.children.concat(d.slice(l)),l=0)}return i},rootDOMTreeNodes(e,t=!1,n=!1,s=0){let o=[];for(const r of e.children)if(r.domNode||n)switch(r.type){case'dom':if(o.push(r),s&&o.length>=s)return o;break;case'boundary':case'pass':case'host':if(!t)break;case'root':if(o=o.concat(i.rootDOMTreeNodes(r,t,n,s&&s-o.length)),s&&o.length>=s)return o.slice(0,s)}return o},allDefsIn(e){const t=[];let n,s=[e],o=0;for(;n=s[o++];)t.push(n),n.childDefs[0]&&(s=n.childDefs.concat(s.slice(o)),o=0);return t},domElementByQuery(e,t,n=!1,s=!1){const o=i.treeNodesWithin(e,{dom:!0},1,n,s,(e=>e.domNode&&e.domNode instanceof Element&&e.domNode.matches(t)))[0];return o&&o.domNode||null},domElementsByQuery:(e,t,n=0,s=!1,o=!1)=>i.treeNodesWithin(e,{dom:!0},n,s,o,(e=>e.domNode&&e.domNode instanceof Element&&e.domNode.matches(t))).map((e=>e.domNode))};var a,d=(e,t,n,s)=>new(n||(n=Promise))(((o,r)=>{function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((e=>{e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}));function l(e,t){for(const n of e.slice()){const s=n[2]||0;if(s&a.OneShot){const t=n[4]||e,s=t.indexOf(n);-1!==s&&t.splice(s,1)}s&a.Deferred?setTimeout((()=>n[0](...n[1]&&t?[...t,...n[1]]:t||n[1]||[])),0):n[0](...n[1]&&t?[...t,...n[1]]:t||n[1]||[])}}function c(e,t,n){const s=n&&(n.includes('first')||n.includes('first-true')),o=n&&(s||n.includes('last')),r=n&&n.includes('no-false'),i=n&&n.includes('no-null');let d=[];for(const l of e.slice()){const c=l[2]||0;if(c&a.OneShot){const t=l[4]||e,n=t.indexOf(l);-1!==n&&t.splice(n,1)}if(c&a.Deferred)setTimeout((()=>l[0](...l[1]&&t?[...t,...l[1]]:t||l[1]||[])),0);else{const e=l[0](...l[1]&&t?[...t,...l[1]]:t||l[1]||[]);if(!e&&(void 0===e||r||i&&null==e))continue;if(o?d[0]=e:d.push(e),s&&(e||!n.includes('first-true')))break}}return o?d[0]:d}function u(e){return class extends e{constructor(...e){super(...e),this.signals={}}listenTo(e,t,n,s=a.None,o){let r=this.signals[e];const i=[t,n||null,s||a.None,null!=o?o:null];r?r.some(((e,n)=>e[0]===t&&(r[n]=i)))||r.push(i):this.signals[e]=r=[i],i[2]&a.OneShot&&i.push(r),this.onListener&&this.onListener(e,r.indexOf(i),!0)}unlistenTo(e,t,n){null==e?e=Object.keys(this.signals):'string'==typeof e&&(e=[e]);const s=null!=n;for(const o of e){const e=this.signals[o];if(e){for(let r=e.length-1;r>=0;r--)t&&e[r][0]!==t||s&&e[r][3]!==n||(this.onListener&&this.onListener(o,r,!1),e.splice(r,1));e[0]||delete this.signals[o]}}}isListening(e,t,n){return null==e?Object.keys(this.signals).some((e=>this.isListening(e,t,n))):!!this.signals[e]&&(!(t&&!this.signals[e].some((e=>e[0]===t)))&&!(null!=n&&!this.signals[e].some((e=>e[3]===n))))}}}function f(e){return class extends(u(e)){sendSignal(e,...t){const n=this.getListenersFor?this.getListenersFor(e):this.signals[e];n&&l(n,t)}sendSignalAs(e,t,...n){const s='string'==typeof e?[e]:e,o=s.includes('delay')||s.includes('pre-delay'),r=s.includes('first')||s.includes('first-true'),i=s.includes('multi')||!r&&!s.includes('last');if(s.includes('await'))return new Promise((e=>d(this,void 0,void 0,(function*(){o&&(yield this.afterRefresh(s.includes('delay')));const a=this.getListenersFor?this.getListenersFor(t):this.signals[t];if(!a)return e(i?[]:void 0);let d=(yield Promise.all(c(a,n))).filter((e=>!(void 0===e||null==e&&s.includes('no-null')||!e&&s.includes('no-false'))));r&&s.includes('first-true')&&(d=d.filter((e=>e)));const l=d.length;l?r?e(i?[d[0]]:d[0]):s.includes('last')?e(i?[d[l-1]]:d[l-1]):e(d):e(i?[]:void 0)}))));if(!o){const e=this.getListenersFor?this.getListenersFor(t):this.signals[t];return e?c(e,n,s):s.includes('last')||r?void 0:[]}(()=>{d(this,void 0,void 0,(function*(){yield this.afterRefresh(s.includes('delay'));const e=this.getListenersFor?this.getListenersFor(t):this.signals[t];e&&(r?c(e,n,s):l(e,n))}))})()}afterRefresh(e=!1){return new Promise((t=>setTimeout(t,e?1:0)))}}}(e=>{e[e.OneShot=1]='OneShot',e[e.Deferred=2]='Deferred',e[e.None=0]='None',e[e.All=3]='All'})(a||(a={}));const h=f;class p extends(u(Object)){}class m extends(f(Object)){}class g extends p{constructor(...e){super(...e),this.treeNodes=new Set}onListener(e,t,n){if(this.treeNodes.size){const s=this.signals[e][t],o=s[0];if(n)for(const t of this.getComponents())t.listenTo(e,((...e)=>s[1]?o(t,...e,...s[1]):o(t,...e)),null,s[2],o);else for(const t of this.getComponents())t.unlistenTo(e,o)}}getTreeNode(){return[...this.treeNodes][this.treeNodes.size-1]||null}getTreeNodes(){return[...this.treeNodes]}getElement(e=!1){let t=this.treeNodes.size-1;const n=[...this.treeNodes];for(;t>=0;){const s=n[t];if(s.domNode&&(!e||'dom'===s.type))return s.domNode}return null}getElements(e=!1){let t=[];for(const n of this.treeNodes)n.domNode&&('dom'===n.type?t.push(n.domNode):e||(t=t.concat(i.rootDOMTreeNodes(n,!0).map((e=>e.domNode)))));return t}getComponent(){var e;const t=[...this.treeNodes][this.treeNodes.size-1];return t&&'boundary'===t.type&&(null===(e=t.boundary)||void 0===e?void 0:e.component)||null}getComponents(){var e;const t=[];for(const n of this.treeNodes)'boundary'===n.type&&(null===(e=n.boundary)||void 0===e?void 0:e.component)&&t.push(n.boundary.component);return t}static didAttachOn(e,t){var n;if(!e.treeNodes.has(t))if(e.treeNodes.add(t),'boundary'===t.type){const s=null===(n=t.boundary)||void 0===n?void 0:n.component;for(const t in e.signals)for(const n of e.signals[t]){const[e,o,r]=n;s.listenTo(t,((...t)=>o?e(s,...t,...o):e(s,...t)),null,r,e)}s&&e.signals.didAttach&&l(e.signals.didAttach,[s])}else'dom'===t.type&&t.domNode&&e.signals.domDidAttach&&l(e.signals.domDidAttach,[t.domNode])}static willDetachFrom(e,t){var n;if(e.treeNodes.has(t))if('boundary'===t.type){const s=null===(n=t.boundary)||void 0===n?void 0:n.component;if(s){e.signals.willDetach&&l(e.signals.willDetach,[s]);for(const t in e.signals)for(const n of e.signals[t])s.unlistenTo(t,n[0])}}else'dom'===t.type&&t.domNode&&e.signals.domWillDetach&&l(e.signals.domWillDetach,[t.domNode]);e.treeNodes.delete(t)}}g.MIX_DOM_CLASS='Ref';var y,D=(e,t)=>{var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(n[s[o]]=e[s[o]])}return n};class M{constructor(e,t){this.hydrationRoot=t||null,this.paused=e.disableRendering,this.settings=e,this.externalElements=new Set,this.inBrowser='object'==typeof document}pause(){this.paused=!0}resume(){this.paused&&(this.paused=!1,this.hydrationRoot&&this.rehydrate(null,!0))}rehydrate(e=null,t=!1,n=!1,s=!1,o,r){var a,d,l;const c=this.hydrationRoot;if(!c)return void(this.settings.devLogWarnings&&console.warn('__HostRender.rehydrate: Warning: No hydration root assigned. ',this));let u=null;const f={};if(e&&(u={tag:(null===(a=e.tagName)||void 0===a?void 0:a.toLowerCase())||'',node:e,parent:null,used:!0},e.childNodes[0])){let t,n=[[[...e.childNodes],u]],s=0;for(;t=n[s];){s++;const[e,o]=t;o.children||(o.children=[]);let r=[];for(const t of e){const e={tag:(null===(d=t.tagName)||void 0===d?void 0:d.toLowerCase())||'',node:t,parent:o},n=t instanceof Element?t.getAttribute('_key'):null;null!=n&&(e.key=n,(f[e.tag]||(f[e.tag]=[])).push(e)),o.children.push(e),t.childNodes[0]&&r.push([[...t.childNodes],e])}r[0]&&(n=r.concat(n.slice(s)),s=0)}}const h=new Set(this.externalElements);e&&h.add(e);let p,m=[[c,u]],g=0;const y=[];for(;p=m[g];){g++;let[e,s]=p;if('dom'===e.type){let i=e.domNode;const a=M.getTreeNodeMatch(e,s,f,h,o,r);if(a){let t=null;a instanceof Node?t=a:(s=a,s.used=!0,t=s.node),!t||e.domNode&&!n||(i=t)}i&&h.add(i);const d={treeNode:e};let l=t;if(i!==e.domNode&&(l=!0,e.domNode?i&&(d.swap=i):d.create=!0),!d.create&&i){const[t,n]=M.findInsertionNodes(e);i.parentNode===t&&i.nextSibling===n||(d.move=!0),'content'===e.def.MIX_DOM_DEF?d.content=!0:(l&&(e.domProps=M.readFromDOM(i)),d.update=!0)}(d.create||d.swap||d.move||d.update||d.content)&&y.push(d)}e.children[0]&&(m=e.children.map((e=>[e,s])).concat(m.slice(g)),g=0)}if(this.settings.disableRendering||(this.paused=!1),s&&e){let t,n=e===c.domNode?i.rootDOMTreeNodes(c.children[0],!0).map((e=>e.domNode)).filter((e=>e)):[...e.childNodes],s=0;for(;t=n[s];)s++,h.has(t)?t.childNodes[0]&&(n=[...t.childNodes,...n.slice(s)],s=0):null===(l=t.parentNode)||void 0===l||l.removeChild(t)}if(y[0]&&this.applyToDOM(y),this.pausedPending){const e=this.pausedPending.filter((e=>e.treeNode.domNode&&!h.has(e.treeNode.domNode)));delete this.pausedPending,e[0]&&this.applyToDOM(e)}}applyToDOM(e){const t=this.settings;if(t.devLogRenderInfos&&console.log('__HostRender.applyToDOM: Dev-log: Received rendering infos'+(this.paused?' (while paused)':'')+': ',e),this.paused){const t=e.filter((e=>e.remove));return void(t[0]&&(this.pausedPending=(this.pausedPending||[]).concat(t)))}let n=null,s=null,o=null;for(const r of e){const e=r.treeNode,i=e.def.attachedSignals,a=e.def.attachedRefs;if(r.remove){if('dom'===e.type&&e.domNode){const t=e.domNode,n=t.parentNode;let r=!1;if((null==i?void 0:i.domWillUnmount)&&i.domWillUnmount(t)&&(r=!0),a)for(const n of a)n.signals.domWillUnmount&&c(n.signals.domWillUnmount,[t],['no-false','last'])&&(r=!0),g.willDetachFrom(n,e);r?o?o.push(t):o=[t]:!n||s&&-1!==s.indexOf(n)||o&&o.some((e=>e.contains(t)))||n.removeChild(t);const d='element'===e.def.MIX_DOM_DEF;(d||'content'===e.def.MIX_DOM_DEF)&&this.externalElements.delete(t),d||(s||(s=[])).push(t),e.domNode=null,M.updateDOMChainBy(e,null)}continue}let d=!1,u=!1;if(r.refresh&&e.domNode&&e.domProps&&(e.domProps='read'===r.refresh?M.readFromDOM(e.domNode):{},d=!0),r.create)switch(e.type){case'dom':const t=this.createDOMNodeBy(e);t&&(e.domNode=t,u=!0);break;case'portal':e.domNode=e.def.domPortal||null}if(u||r.move)if('host'===e.type){const t=e.def.host||null;t&&t.services.refreshRoot(!1,null,null),e.domNode=e.parent&&t&&t.getRootElement()||null,M.updateDOMChainBy(e,e.domNode)}else e.domNode&&(n||(n=[])).push(r);if(r.swap){const n=!0!==r.swap,s=e.domNode;let o=n?r.swap:('portal'===e.type?e.def.domPortal:e.def.domElement)||null;if(s!==o){if(!n&&'dom'===e.type){const n=e,r=s&&s.parentNode;if(o&&(o=this.getApprovedNode(o,n),o)){let[t,n]=r?[r,s]:M.findInsertionNodes(e);t&&t.insertBefore(o,n)}if(s){if(this.externalElements.delete(s),n.domProps&&s instanceof Element)for(const e in n.domProps){const t=M.LISTENER_PROPS[e];t&&s.removeEventListener(t,n.domProps[e])}r&&r.removeChild(s)}n.domProps&&(n.domProps=o&&'read'===t.renderDOMPropsOnSwap?M.readFromDOM(o):{},d=!0)}for(const t of e.children){const e=t.domNode;e&&(e.parentNode&&e.parentNode.removeChild(e),o&&o.appendChild(e))}e.domNode=o,M.updateDOMChainBy(e,o)}}if(r.content&&'dom'===e.type&&e.domNode){const n=e.def.domContent,s=e.domNode;let o=s;if('content'===e.def.MIX_DOM_DEF){if(e.def.domHTMLMode&&null!=n&&''!==n)o=M.domNodeFrom(n.toString(),e.def.tag||t.renderHTMLDefTag,!0),o&&e.domProps&&(d=!0,e.domProps={});else{const e=null==n?'':(t.renderTextHandler?t.renderTextHandler(n):n).toString();3!==s.nodeType&&this.inBrowser?o=document.createTextNode(e):s.textContent=e}}else if(n instanceof Node){const e=n.parentNode;e&&e.removeChild(n)}else s.textContent='';if(o&&s!==o){const t=s.parentNode;t&&(e.domNode=o,t.insertBefore(o,s),t.removeChild(s)),M.updateDOMChainBy(e,e.domNode)}if((null==i?void 0:i.domDidContent)&&i.domDidContent(e.domNode,null!=n?n:null),a)for(const t of a)t.signals.domDidContent&&l(t.signals.domDidContent,[e.domNode,null!=n?n:null])}if((u||d||r.update)&&'dom'===e.type){const[n,s,o]=M.domApplyProps(e,t.devLogWarnings);if(e.domProps=n,o&&r.update&&s&&((null==i?void 0:i.domDidUpdate)&&i.domDidUpdate(s,o),a))for(const e of a)e.signals.domDidUpdate&&l(e.signals.domDidUpdate,[s,o])}r.emptyMove&&M.updateDOMChainBy(e,null,!0)}if(n){const e=[];let t=null,s=n.length;for(;s--;){const o=n[s],r=o.treeNode,i=r.domNode;if(i){const n=i.parentNode,s=i.nextSibling,[a,d]=i?M.findInsertionNodes(r):[null,null];a===n&&d===s||(a&&e.push([i,a,d]),(r.def.attachedRefs||r.def.attachedSignals)&&(t||(t=[])).push([!o.move,o.treeNode,n,s]),n&&n.removeChild(i))}M.updateDOMChainBy(r,i)}if(e[0])for(const t of e)t[1].insertBefore(t[0],t[2]);if(t){let e=t.length;for(;e--;){const[n,s,o,r]=t[e],{attachedSignals:i,attachedRefs:a}=s.def,d=s.domNode;if(i&&(n?i.domDidMount&&i.domDidMount(d):i.domDidMove&&i.domDidMove(d,o,r)),a)for(const e of a)n?(g.didAttachOn(e,s),e.signals.domDidMount&&l(e.signals.domDidMount,[d])):e.signals.domDidMove&&l(e.signals.domDidMove,[d,o,r])}}}}getApprovedNode(e,t){let n=e;const s=null!=t.def.domCloneMode?t.def.domCloneMode:this.settings.duplicateDOMNodeBehaviour;return('always'===s||this.externalElements.has(e))&&(n=this.settings.duplicateDOMNodeHandler?this.settings.duplicateDOMNodeHandler(e,t):s?e.cloneNode('deep'===s||'always'===s):null),n&&this.externalElements.add(n),n}createDOMNodeBy(e){const t=e.def.tag;if('string'!=typeof t)return null;if('_'===t)return e.def.domElement&&this.getApprovedNode(e.def.domElement,e)||null;const n=e.def.domContent;if(n instanceof Node)return this.getApprovedNode(n,e);const s=this.settings;if(e.def.domHTMLMode&&null!=n&&''!==n)return M.domNodeFrom(n.toString(),t||s.renderHTMLDefTag,!0);if(t)return this.inBrowser?'svg'===t||e.parent&&e.parent.domNode&&void 0!==e.parent.domNode.ownerSVGElement?document.createElementNS(s.renderSVGNamespaceURI||'http://www.w3.org/2000/svg',t):document.createElement(t):null;let o=null,r='',i='';if(null!=n){i=(s.renderTextHandler?s.renderTextHandler(n):n).toString();const e=s.renderTextTag;if(e)if('string'==typeof e)r=e;else if('function'==typeof e){const t=e(n);t instanceof Node&&(o=t)}}if(!o){if(!this.inBrowser)return null;o=r?document.createElement(r):document.createTextNode(i)}return r&&i&&(o.textContent=i),o}static findInsertionNodes(e){let t=null,n=e.parent;for(;n;){if(!(M.PASSING_TYPES[n.type]||'root'===n.type&&n.parent)){t=n.domNode;break}n=n.parent}if(!t)return[null,null];let s=null,o=e;for(;o&&(n=o.parent,n);){let e,r=n.children.indexOf(o)+1;for(;e=n.children[r];){if(e.domNode&&'portal'!==e.type){s=e.domNode;break}r++}if(s||n.domNode===t)break;o=n}return[t,s]}static updateDOMChainBy(e,t,n=!1){let s=e,o=n?e:e.parent,r=t;for(;o&&(M.PASSING_TYPES[o.type]||o===s);){if(o.children[0]!==s&&o!==s){let e=!1,t=o.children.indexOf(s)-1;for(;t>=0;){if(o.children[t].domNode){e=!0;break}t--}if(e)break}if(!r){let e,t=o.children.indexOf(s)+1;for(;e=o.children[t];){if(e.domNode&&'portal'!==e.type){r=e.domNode;break}t++}if(r&&o.domNode===r)break}o.domNode=r,s=o,o=o.parent}}static readFromDOM(e){const n={};if(!(e instanceof Element))return n;for(const t of e.getAttributeNames())n['class'===t?'className':t]=e.getAttribute(t);const s=e.style.cssText;s&&(n.style=t.cleanDOMStyle(s));const o=e.dataset;if(o&&Object.keys(o).length){n.data={};for(const e in o)n.data[e]=o[e]}return n}static domNodeFrom(e,t='div',n=!1){const s=t instanceof Element?t:'object'==typeof document?document.createElement(t):null;return s?(s.innerHTML=e,n||s.children[1]?s:s.children[0]):null}static domApplyProps(e,n=!1){const s=e.domNode instanceof Element?e.domNode:null,o={},r=e.domProps||{},i=e.def.props||{},a=t.getDictionaryDiffs(r,i);if(!a)return[i,s];const d={};for(const l in a){const c=M.SPECIAL_PROPS[l];if(c){if('render'===c)n&&console.warn('__HostRender.domApplyProps: Warning: Is using an ignored dom prop: ',l,' for treeNode: ',e);else if('className'===l){const e=t.getClassNameDiffs(r.className,i.className);if(e){if(d.classNames=e,s)for(const t in e)s.classList[e[t]?'add':'remove'](t);i.className?o.className=i.className:delete o.className}}else{const e=i[l],n=t.getDictionaryDiffs(r[l]||{},e||{});if(n){if(d[l]=n,s)if('data'===l){const e=s.dataset;if(e)for(const t in n)void 0!==n[t]?e[t]=n[t]:delete e[t]}else{const e=s.style;if(e)for(const t in n)e[t]=null!=n[t]?n[t]:null}e?o[l]=e:delete o[l]}}continue}const u=a[l],f=void 0!==u,h=M.LISTENER_PROPS[l];if(h){if(d.listeners||(d.listeners={}),d.listeners[l]=u,s){const e=r[l];e&&s.removeEventListener(h,e),f&&s.addEventListener(h,u)}}else d.attributes||(d.attributes={}),d.attributes[l]=u,s&&(f?s.setAttribute(l,u):s.removeAttribute(l));f?o[l]=u:delete o[l]}for(const e in d)return[o,s,d];return[o,s]}static readAsString(e){const n=e.def;if(!n)return'';let s=n.tag,o='';if('string'!=typeof s){for(const t of e.children)o+=M.readAsString(t);return o}let r=null;if(s)'_'===s&&(r=n.domElement||null);else{const e=n.domContent;e&&(e instanceof Node?r=e:o+=e.toString())}if(!s&&!r)return o;let i=e.domProps;if(r){if(r instanceof Element&&(s=r.tagName.toLowerCase()||''),!s)return r.textContent||'';const e=M.readFromDOM(n.domElement),{className:t,style:o,data:a}=e,d=D(e,['className','style','data']);if(t&&(i.className=i.className?i.className+' '+t:t),o){i.style=i.style||{};for(const e in o)i.style[e]=o[e]}if(a){i.data=i.data||{};for(const e in a)i.data[e]=a[e]}for(const e in d)i[e]=d[e]}const{className:a,style:d,data:l}=i,c=D(i,['className','style','data']);if(o+='<'+s,a&&(o+=' class="'+a+'"'),d){let e='';for(const t in d)e+=t+': '+d[t]+';';e&&(o+=' style="'+e+'"')}if(l)for(const e in l)o+=' data-'+t.decapitalize(e,'-')+'="'+l[e].toString()+'"';for(const e in c)M.LISTENER_PROPS[e]||M.SPECIAL_PROPS[e]||(o+=' '+e+'="'+c[e].toString()+'"');if(M.SIMPLE_TAGS[s])o+='/>';else{o+='>';for(const t of e.children)o+=M.readAsString(t);o+='</'+s+'>'}return o}static getTreeNodeMatch(e,t,n,s,o,r){const i=e.def.tag,a=e.def.key;if(r){const n=r(t,e,i,a);if(n){if((n instanceof Element?n.tagName.toLowerCase():'')===i&&(n instanceof Node?!(null==s?void 0:s.has(n)):!(null==s?void 0:s.has(n.node))&&M.isVirtualItemOk(e,n,t,o)))return n}}const d=null!=a;if(t)for(const n of t.used?t.children||[]:[t])if(!n.used&&n.tag===i&&(d?n.key===a:null==n.key)&&!(null==s?void 0:s.has(n.node))&&(!o||o(n,e,i,a)))return n;if(n&&d){const r=n[i];if(r)for(const n of r)if(!n.used&&n.key===a&&!(null==s?void 0:s.has(n.node))&&M.isVirtualItemOk(e,n,t,o))return n}return null}static isVirtualItemOk(e,t,n,s){if(t.tag!==e.def.tag)return!1;const o=e.def;if(n){let r=t;for(;r;){if(r===n)return!s||s(t,e,o.tag,o.key);r=r.parent}}else if(!s||s(t,e,o.tag,o.key))return!0;return!1}}M.SIMPLE_TAGS=['img'],M.SPECIAL_PROPS={innerHTML:'render',outerHTML:'render',textContent:'render',innerText:'render',outerText:'render',style:'other',data:'other',className:'other'},M.PASSING_TYPES={boundary:!0,pass:!0,host:!0,fragment:!0},M.LISTENER_PROPS=['Abort','Activate','AnimationCancel','AnimationEnd','AnimationIteration','AnimationStart','AuxClick','Blur','CanPlay','CanPlayThrough','Change','Click','Close','ContextMenu','CueChange','DblClick','Drag','DragEnd','DragEnter','DragLeave','DragOver','DragStart','Drop','DurationChange','Emptied','Ended','Error','Focus','FocusIn','FocusOut','GotPointerCapture','Input','Invalid','KeyDown','KeyPress','KeyUp','Load','LoadedData','LoadedMetaData','LoadStart','LostPointerCapture','MouseDown','MouseEnter','MouseLeave','MouseMove','MouseOut','MouseOver','MouseUp','Pause','Play','Playing','PointerCancel','PointerDown','PointerEnter','PointerLeave','PointerMove','PointerOut','PointerOver','PointerUp','Progress','RateChange','Reset','Resize','Scroll','SecurityPolicyViolation','Seeked','Seeking','Select','Stalled','Submit','Suspend','TimeUpdate','Toggle','TouchCancel','TouchEnd','TouchMove','TouchStart','TransitionCancel','TransitionEnd','TransitionRun','TransitionStart','VolumeChange','Waiting','Wheel'].reduce(((e,t)=>(e['on'+t]=t.toLowerCase(),e)),{});class b{constructor(e){}}b.MIX_DOM_CLASS='Fragment';class v{constructor(e){}}v.MIX_DOM_CLASS='Portal';class C{constructor(e){}}C.MIX_DOM_CLASS='Element';class _{constructor(e){}render(){return null}}_.MIX_DOM_CLASS='Empty';const P=((y=class extends _{static isStream(){return!1}}).Content=null,y.ContentCopy=null,y.copyContent=e=>null,y.WithContent=(e,t)=>null,y),O={SEARCH_TAG_BY_TYPE:{fragment:1,portal:2,pass:3,host:4},runPassUpdate(e,t=!1){const[n,s,o]=O.assignTreeNodesForPass(e);let[r,i]=O.applyDefPairs(e,n,t);if(s[0]){const e=new Set;for(const t of s)t.sourceBoundary||(t.def&&e.add(t.def),t.parent=null);if(e.size){const t=O.cleanUpDefs(e);r=t[0].concat(r),i=t[1].concat(i)}}return o[0]&&(r=o.map((e=>({treeNode:e,emptyMove:!0}))).concat(r)),e.isMounted=!0,[r,i]},runBoundaryUpdate(e,t=!1){let n,s,o=null,i=e._innerDef;e.bId?(o=r.newDefFrom(e.render()),o&&!i&&(i=r.newAppliedDef(o,e.closure))):o=e.targetDef;const[a,d]=i?O.buildDefMaps(i):[new Map,new Set],l=[];if(o){const r=[],c=O.pairDefs(e,o,i,a,d,r,l);if(e._innerDef=c[0][1],[n,s]=O.applyDefPairs(e,c,t),r[0])for(const e of r){const t=e.treeNode;t&&null===t.sourceBoundary&&d.add(e)}}else n=[],s=[],!i&&e.isMounted||l.push(e.treeNode),e.innerBoundaries=[],e.treeNode.children=[],e._innerDef=null;if(d.size){const e=O.cleanUpDefs(d);n=e[0].concat(n),s=e[1].concat(s)}return l[0]&&(n=l.map((e=>({treeNode:e,emptyMove:!0}))).concat(n)),e.isMounted||(e.isMounted=!0),[n,s]},applyDefPairs(e,n,s=!1){var o,r;const a=e.bId?e:e.sourceBoundary,d=[],l=e.host.settings.preCompareDOMProps;e.innerBoundaries=[];let c=[[],[]];for(const u of n){const[n,f,h]=u,p='mounted'===f.action;if(!p&&'moved'===f.action)switch(f.MIX_DOM_DEF){case'fragment':for(const e of i.rootDOMTreeNodes(h,!0,!0))-1===d.indexOf(e)&&(d.push(e),c[0].push({treeNode:e,move:!0}));break;case'host':f.host&&f.host.groundedTree.parent===h&&c[0].push({treeNode:h,move:!0})}if('fragment'===f.MIX_DOM_DEF)continue;if('pass'===h.type){if('pass'!==f.MIX_DOM_DEF)continue;let t=f.contentPass,n=le.key;if(f.getStream){const e=f.getStream();n=null===(o=e.Content)||void 0===o?void 0:o.key;const s=e.closure||null;t!==s&&(t&&O.mergeChanges(c,t.contentUngrounded(f)),f.contentPass=s,t=s)}t&&O.mergeChanges(c,t.contentGrounded(f,e,h,f.key!==n?f.key:null)),h.boundary&&e.innerBoundaries.push(h.boundary);continue}const m=f.props;let y=!1;n.props&&f.props!==n.props&&(h.boundary&&(h.boundary._outerDef.props=n.props),f.props=n.props||{});let D=!1;switch(f.MIX_DOM_DEF){case'content':D=!0;const t=n.domHTMLMode;y=f.domContent!==n.domContent||t!==n.domHTMLMode,y&&(f.domContent=n.domContent,void 0!==t?f.domHTMLMode=t:delete f.domHTMLMode);break;case'element':D=!0,f.domElement!==n.domElement&&(p||c[0].push({treeNode:h,swap:!0}),f.domElement=n.domElement||null),f.domCloneMode=null!=n.domCloneMode?n.domCloneMode:null;break;case'dom':D=!0;break;case'portal':f.domPortal!==n.domPortal&&(c[0].push({treeNode:h,[p?'create':'swap']:!0}),f.domPortal=n.domPortal||null);break;case'boundary':if(p){n.attachedContexts&&(f.attachedContexts=n.attachedContexts);const t=new Z(e.host,f,h,a);t.parentBoundary=e,h.boundary=t}break;case'host':if(f.host){const e=f.host;let t=e;if('mounted'===f.action){if(e.groundedTree.parent){const n=t.settings.duplicatableHost;if('function'==typeof n){const e=n(f.host,h);if(!e)break;if('object'==typeof e){if(e.groundedTree.parent)break;t=e}}else if(!n)break;const s=e.shadowAPI;t===e?t=new ee(e.services.getRootDef(!0),null,e.settings,null,s):t.shadowAPI!==e.shadowAPI&&(t.shadowAPI.hosts.delete(t),t.shadowAPI=e.shadowAPI);for(const e in s.contexts){const n=s.contexts[e];n&&t.contextAPI.setContext(e,n,!1)}f.host=t}e.shadowAPI.hosts.add(t)}t.groundedTree.parent=h,h.children=[t.groundedTree],c[0].push({treeNode:h,move:!0});break}}if(D){if(p)c[0].push({treeNode:h,create:!0});else{const e='moved'===f.action&&-1===d.indexOf(h),s=!!f.tag&&(!l||'if-needed'===l&&(y||e)||!t.equalDOMProps(m||{},n.props||{}));if(s||y||e){const t={treeNode:h};s&&(t.update=!0),y&&(t.content=!0),e&&(t.move=!0,d.push(h)),c[0].push(t)}}f.attachedSignals!==n.attachedSignals&&(n.attachedSignals?f.attachedSignals=n.attachedSignals:delete f.attachedSignals)}if(h.boundary){const o=h.boundary;if(e.innerBoundaries.push(o),p){if(f.tag&&f.tag._WithContent){const e=f.tag._WithContent,t=e.getStream?e.getStream().closure:a.closure;(t.withContents||(t.withContents=new Set)).add(o)}o.reattach()}const i=o.component;if(f.attachedSignals!==n.attachedSignals){const e=t.getDictionaryDiffs(f.attachedSignals||{},n.attachedSignals||{});if(e)for(const t in e)e[t]?i.listenTo(t,e[t]):i.unlistenTo(t,f.attachedSignals[t]);f.attachedSignals=n.attachedSignals}if(f.attachedContexts!==n.attachedContexts){if(i.contextAPI){const e=t.getDictionaryDiffs(f.attachedSignals||{},n.attachedSignals||{});if(e){for(const t in e)e[t]?i.contextAPI.setContext(t,e[t]):i.contextAPI.setContext(t,null);i.contextAPI.callDataBy(p||Object.keys(e))}}f.attachedContexts=n.attachedContexts}let l=null;const u=o.closure.envelope;n.childDefs[0]&&(l=u?{applied:Object.assign(Object.assign({},u.applied),{childDefs:f.childDefs,action:f.action}),target:Object.assign(Object.assign({},u.target),{childDefs:n.childDefs})}:{applied:{tag:null,MIX_DOM_DEF:'fragment',childDefs:f.childDefs,action:'mounted'},target:{tag:null,MIX_DOM_DEF:'fragment',childDefs:n.childDefs}}),'Stream'===i.constructor.MIX_DOM_CLASS&&(c=O.mergeChanges(c,i.reattachSource()));const m=u||l?o.closure:null;let g=null;if(m){g=m.preRefresh(l);const e=a.closure;f.hasPassWithin?(e.chainedClosures||(e.chainedClosures=new Set)).add(m):null===(r=e.chainedClosures)||void 0===r||r.delete(m)}c=O.mergeChanges(c,e.host.services.updateBoundary(o,s,d,g)),m&&(c=O.mergeChanges(c,m.applyRefresh(s)))}if(f.attachedRefs||n.attachedRefs){const e=f.attachedRefs,t=n.attachedRefs;if(e)for(const n of e)t&&t.includes(n)||g.willDetachFrom(n,h);if(t)for(const n of t)e&&e.includes(n)||g.didAttachOn(n,h);f.attachedRefs=t}}return c},pairDefs(e,t,n,s,o,r,i){const a=e.host.settings,d=a.noRenderValuesMode,l=a.wideKeysInArrays,c=[],u=e.bId?e:e.sourceBoundary;let f,h=[[{childDefs:[t]},{childDefs:[n]},e.treeNode,!1,null]],p=0;for(;f=h[p];){p++;const[e,t,n,a]=f,m='spread-pass'===t.scopeType?void 0:t.scopeMap||f[5];if(e.childDefs[0]){const c=O.findAppliedDefsFor(t,e,m||s,o,u,l);t.childDefs=c;for(let n,s=0;n=e.childDefs[s];s++)if('content'===n.MIX_DOM_DEF){const e=t.childDefs[s];d&&(!0===d?!n.domContent:-1!==d.indexOf(n.domContent))?e.disabled=!0:delete e.disabled}const g='boundary'===e.MIX_DOM_DEF,y=f[4]||g&&t;g&&delete t.hasPassWithin;const D=!n||g||'element'===e.MIX_DOM_DEF&&!e.domElement?[]:O.assignTreeNodesFor(c,n,a,u,i),M=[];for(let t,n=0;t=e.childDefs[n];n++){const e=D[n]||null,s=c[n];!e&&s.treeNode&&(s.treeNode.sourceBoundary=null,r&&r.push(s)),y&&'pass'===t.MIX_DOM_DEF&&(y.hasPassWithin=!0);const o=[t,s,e,'fragment'===t.MIX_DOM_DEF,y||'boundary'===t.MIX_DOM_DEF&&s||null];M.push(o),m&&(o[5]=m)}h=M.concat(h.slice(p)),p=0}else t.childDefs=[];n&&e.MIX_DOM_DEF&&t.MIX_DOM_DEF&&c.push([e,t,n])}return c},findAppliedDefsFor(e,n,s,o,i,a){var d,l,c,u,f,h;let p=n.childDefs.length;if(!p)return[];const m=a||!n.isArray;if(!a&&n.isArray!=(e&&e.isArray))return n.childDefs.map((e=>r.newAppliedDef(e,i&&i.closure||null)));const g=e&&e.childDefs||null,y=[];for(let a=0;a<p;a++){const p=n.childDefs[a],D=null!=p.key,M=p.MIX_DOM_DEF,b=p.getStream||O.SEARCH_TAG_BY_TYPE[M]||p.tag;let v=!1,C=null;if(g)for(const e of g)if((D?e.key===p.key:null==e.key)&&b===(e.getStream||O.SEARCH_TAG_BY_TYPE[e.MIX_DOM_DEF]||e.tag)&&o.has(e)&&('boundary'!==M||!(null===(c=null===(l=null===(d=e.treeNode)||void 0===d?void 0:d.boundary)||void 0===l?void 0:l.component)||void 0===c?void 0:c.constantProps)||t.equalDictionariesBy(p.props,e.props,e.treeNode.boundary.component.constantProps))){C=e,o.delete(e);break}if(!C&&D&&m){const e=s&&s.get(b);if(e)for(const n of e)if(n.key===p.key&&o.has(n)&&('boundary'!==M||!(null===(h=null===(f=null===(u=n.treeNode)||void 0===u?void 0:u.boundary)||void 0===f?void 0:f.component)||void 0===h?void 0:h.constantProps)||t.equalDictionariesBy(p.props,n.props,n.treeNode.boundary.component.constantProps))){C=n,o.delete(n),v=!0;break}}C?C.action=v||!e||e.childDefs[a]!==C?'moved':'updated':C=r.newAppliedDef(p,i&&i.closure||null),y.push(C)}return y},assignTreeNodesFor(e,t,n,s,o){t.children[0]&&(t.children=[]);const r=e.length;if(!r)return[];const i=[];let a=0,d=null,l=t;if(n){if(!t.parent)return[];if(l=t.parent,d=t,a=l.children.indexOf(t),-1===a)return[]}for(let t=0;t<r;t++){const n=e[t];if(n.disabled){a--,i.push(null);continue}let r=null;n.treeNode?r=n.treeNode:'fragment'!==n.MIX_DOM_DEF&&(n.action='mounted'),d&&(r?l.children.splice(a,1):r=d,d=null);const c=n.MIX_DOM_DEF,u='content'===c||'element'===c?'dom':'fragment'===c?'':c;if(r){if(r.parent){const e=r.parent.children.indexOf(r);0===e&&r.parent!==l&&!0===M.PASSING_TYPES[r.parent.type]&&o&&-1===o.indexOf(r.parent)&&o.push(r.parent),-1!==e&&r.parent.children.splice(e,1)}r.parent=l,r.sourceBoundary=s||null,r.type=u}else r={type:u,parent:l,children:[],sourceBoundary:s||null,domNode:null},'dom'===r.type&&(r.domProps={});'fragment'!==n.MIX_DOM_DEF&&(r.def=n,n.treeNode=r),l.children.splice(a+t,0,r),i.push(r)}return i},assignTreeNodesForPass(e){const t=e._innerDef,n=e.sourceBoundary,s=[],o=[],r=[];let i,a=[[e.targetDef,t,e.treeNode,!1]],d=0;for(;i=a[d];){d++;const[e,t,l,c]=i;if(t.childDefs[0]){const r=l&&'boundary'!==e.MIX_DOM_DEF&&('element'!==e.MIX_DOM_DEF||e.domElement)?O.assignTreeNodesFor(t.childDefs,l,c,n,o):[];let i=0;const u=[];for(const n of t.childDefs){const t=r[i]||null;!t&&n.treeNode&&(s.push(n.treeNode),n.treeNode.sourceBoundary=null),u.push([e.childDefs[i],n,t,'fragment'===n.MIX_DOM_DEF]),i++}a=u.concat(a.slice(d)),d=0}l&&!t.disabled&&r.push([e,t,l])}return[r,s,o]},buildDefMaps(e,t=!1,n=new Set,s){const o=new Map;let r,i=t?e.childDefs.slice():[e],a=0;for(;r=i[a];){a++,n.add(r);const e=r.getStream||O.SEARCH_TAG_BY_TYPE[r.MIX_DOM_DEF]||r.tag,t=o.get(e);if(t?t.push(r):o.set(e,[r]),r.scopeType)if('spread-pass'===r.scopeType)s&&s.push(r);else{const e=[];r.scopeMap=O.buildDefMaps(r,!0,n,e)[0],e[0]&&(i=e[0].childDefs.concat(i.slice(a)),a=0)}else r.childDefs[0]&&(i=r.childDefs.concat(i.slice(a)),a=0)}return[o,n]},cleanUpDefs(e,t=!0,n=!0){var s;let o=[[],[]];for(const r of e){const e=r.treeNode;if(e){switch(r.MIX_DOM_DEF){case'dom':case'element':case'content':n&&o[0].push({treeNode:e,remove:!0});break;case'boundary':e.boundary&&(o=O.mergeChanges(o,O.destroyBoundary(e.boundary,!1,n)));break;case'pass':r.contentPass&&(o=O.mergeChanges(o,r.contentPass.contentUngrounded(r)));case'host':{const t=r.host;if(t&&t.groundedTree.parent===e){t.groundedTree.parent=null,e.children=[],o[0].push({treeNode:e,move:!0}),t.shadowAPI.hosts.delete(t);const n=t.contextAPI;for(const e in n.contexts)null===(s=n.contexts[e])||void 0===s||s.contextAPIs.delete(n)}}default:if(r.attachedRefs&&r.MIX_DOM_DEF)for(const t of r.attachedRefs)g.willDetachFrom(t,e)}t&&(e.parent=null,e.sourceBoundary=null,delete r.treeNode)}}return o},destroyBoundary(e,t=!0,n=!0){var s,o,r,a;let d=[[],[]];if(null===e.isMounted)return d;const c=e.bId?e:null;if(c){const e=c.component,t=e.constructor;e.signals.willUnmount&&l(e.signals.willUnmount);const n=c._outerDef;if(n.attachedRefs)for(const e of n.attachedRefs)g.willDetachFrom(e,c.treeNode);null===(o=null===(s=c.sourceBoundary)||void 0===s?void 0:s.closure.chainedClosures)||void 0===o||o.delete(c.closure);const i=e.contextAPI;if(i){for(const e in i.contexts)null===(r=i.contexts[e])||void 0===r||r.contextAPIs.delete(i);i.contexts={},c.host.contextComponents.delete(e)}if(t.api&&(t.api.components.delete(e),t.api.signals&&(t.api.signals={})),'Stream'===t.MIX_DOM_CLASS&&(d=O.mergeChanges(d,t.removeSource(e))),n.tag._WithContent){const e=n.tag._WithContent,t=e.getStream?e.getStream().closure:null===(a=c.sourceBoundary)||void 0===a?void 0:a.closure;(null==t?void 0:t.withContents)&&(t.withContents.delete(c),t.withContents.size||delete t.withContents)}e.signals&&(e.signals={}),e.timers&&e.clearTimers()}return n&&(d[0]=d[0].concat(i.rootDOMTreeNodes(e.treeNode,!0).map((e=>({treeNode:e,remove:!0}))))),e._innerDef&&(d=O.mergeChanges(d,O.cleanUpDefs(i.allDefsIn(e._innerDef),t,!1))),c&&c.host.services.cancelUpdates(c),e.isMounted=null,d},sortBoundaries(e){const t=new Map;for(const n of e){let e=n.bId,s=n.parentBoundary;for(;s;)e=(s.bId||'')+'>'+e,s=s.parentBoundary;const o=t.get(e);if(o){let e=0;if(n.parentBoundary){const t=n.parentBoundary.innerBoundaries,s=t.indexOf(n);for(const n of o){if(s<t.indexOf(n))break;e++}}o.splice(e,0,n)}else t.set(e,[n])}const n=[];for(const e of t.keys()){let t=0,s=!1;for(const o of n){if(o.startsWith(e+'>'))break;if(e.startsWith(o+'>'))s=!0;else if(s)break;t++}n.splice(t,0,e)}let s=0;for(const o of n)for(const n of t.get(o))e[s]=n,s++},mergeChanges(e,...t){let n=e;for(const e of t)e&&(n?(n[0]=n[0].concat(e[0]),n[1]=n[1].concat(e[1])):n=e);return n}};class N{constructor(e){this.host=e,this.renderer=new M(e.settings,e.groundedTree),this.bIdCount=0,this.updateTimer=null,this.renderTimer=null,this.updatesPending=new Set,this.rInfosPending=[],this.rCallsPending=[]}createBoundaryId(){return'h-'+this.host.constructor.idCount.toString()+':b-'+(this.bIdCount++).toString()}clearTimers(e=!1){e||this.runUpdates(null),null!=this.updateTimer&&(clearTimeout(this.updateTimer),this.updateTimer=null),null!=this.renderTimer&&(clearTimeout(this.renderTimer),this.renderTimer=null)}createRoot(e){return this.rootDef=r.newDefFrom(e),(e,t)=>()=>this._rootDisabled?null:this.rootDef}updateRoot(e,t,n){this.rootDef=r.newDefFrom(e),this.host.rootBoundary.update(!0,t,n)}refreshRoot(e=!1,t,n){const s=!this._rootDisabled,o=this.host,r=!(o.settings.onlyRunInContainer&&!o.groundedTree.domNode&&!o.groundedTree.parent);if(r?delete this._rootDisabled:this._rootDisabled=!0,!e&&r&&s){if(r&&s){const e=o.rootBoundary?i.rootDOMTreeNodes(o.rootBoundary.treeNode,!0).map((e=>({treeNode:e,move:!0}))):[];this.absorbChanges(e,null,n)}}else o.rootBoundary.update(!0,t,n)}clearRoot(e=!1){this.clearTimers(e),this.rootDef=null}getRootDef(e){return this.rootDef&&(e?Object.assign({},this.rootDef):this.rootDef)}hasPending(e=!0,t=!0){return e&&null!==this.updateTimer||t&&null!==this.renderTimer}cancelUpdates(e){this.updatesPending.delete(e)}absorbUpdates(e,t,n=!0,s,o){if(null!==e.isMounted){if(t.force&&(e._forceUpdate='all'===e._forceUpdate?'all':t.force),t.props&&(e._outerDef.props=t.props),t.state){const n=e.component;n._lastState||(n._lastState=Object.assign({},n.state)),n.state=t.state}e._renderState?e._renderState='re-updated':(this.updatesPending.add(e),n&&this.triggerUpdates(s,o))}}triggerUpdates(e,t){void 0!==t&&(null===t||void 0===this._renderTimeout||null!==this._renderTimeout&&t<this._renderTimeout)&&(this._renderTimeout=t),this._isUpdating||this.triggerRefreshFor('update',e)}runUpdates(e){for(this.updateTimer=null,this._isUpdating=!0,e=void 0!==e?e:void 0!==this._renderTimeout?this._renderTimeout:this.host.settings.renderTimeout,delete this._renderTimeout;this.updatesPending.size;){let e=[...this.updatesPending];this.updatesPending.clear(),e[1]&&O.sortBoundaries(e);let t=[],n=[];for(const s of e){const e=this.updateBoundary(s);e&&(t=t.concat(e[0]),n=n.concat(e[1]))}t[0]&&this.rInfosPending.push(t),n[0]&&(this.host.settings.useImmediateCalls?N.callBoundariesBy(n):this.rCallsPending.push(n))}this._afterUpdate&&this.callAndClear('_afterUpdate'),this.triggerRefreshFor('render',e),delete this._isUpdating}updateBoundary(e,t=!1,n,s){let o=!!t,r='all'===t,a=[],d=[];const u=e.component,f=!e.isMounted;if(f){if(null===e.isMounted)return null;d.push([e,'mounted']),o=!0}const h=e._outerDef.props!==u.props?u.props||{}:void 0;h&&(u.props=e._outerDef.props);const p=u.constructor.api;if(p&&(f||h)&&(f&&p.onBuildProps&&!p.builtProps&&(p.builtProps=p.onBuildProps(null)),p.getMixedProps&&(f||u._lastState||(u._lastState=Object.assign({},u.state)),u.state=p.getMixedProps(u))),!f&&u.signals.beforeUpdate&&l(u.signals.beforeUpdate),e._forceUpdate&&('all'===e._forceUpdate&&(r=!0),o=!0,delete e._forceUpdate),!f){const t=u._lastState;if(delete u._lastState,o||h||t){if(!o){const n=u.signals.shouldUpdate?c(u.signals.shouldUpdate,[u,h,t],['first-true','no-false']):null;(!0===n||null==n&&N.shouldUpdateBy(e,h,t))&&(o=!0)}const s='moved'===e._outerDef.action;if(s&&d.push([e,'moved']),o&&d.push([e,'updated',h,t]),s)for(const t of i.rootDOMTreeNodes(e.treeNode,!0,!0)){if(n){if(-1!==n.indexOf(t))continue;n.push(t)}a.push({treeNode:t,move:!0})}u.signals.preUpdate&&l(u.signals.preUpdate,[h,t,o])}}if(o){const[t,n]=O.runBoundaryUpdate(e,r);a=a.concat(t),d=d.concat(n)}if(u.wired)for(const e of u.wired){if(e.api.onBuildProps){const t=e.api.builtProps;if(e.api.builtProps=e.api.onBuildProps(t),t===e.api.builtProps)continue}if(e.api.components.size){s||(s=new Set);for(const t of e.api.components)t.boundary._outerDef.props=Object.assign({},t.boundary._outerDef.props),s.add(t.boundary)}}const m='Stream'===e.component.constructor.MIX_DOM_CLASS;if(s&&s.size){const e=N.updateInterested(s,!0);a=a.concat(e[0]),d=d.concat(e[1])}return m&&e.component.refreshSource(),a[0]||d[0]?[a,d]:null}absorbChanges(e,t,n){e&&this.rInfosPending.push(e),t&&(this.host.settings.useImmediateCalls?N.callBoundariesBy(t):this.rCallsPending.push(t)),this.triggerRefreshFor('render',n)}runRender(){this.renderTimer=null;const e=this.rInfosPending;this.rInfosPending=[];for(const t of e)t[0]&&this.renderer.applyToDOM(t);const t=this.rCallsPending;this.rCallsPending=[];for(const e of t)e[0]&&N.callBoundariesBy(e);this._afterRender&&this.callAndClear('_afterRender')}triggerRefreshFor(e,n){'update'===e?this.updateTimer=t.callWithTimeout(this,this.runUpdates,this.updateTimer,this.host.settings.updateTimeout,n):this.renderTimer=t.callWithTimeout(this,this.runRender,this.renderTimer,this.host.settings.renderTimeout,n)}static updateInterested(e,t=!0){let n=[],s=[];t&&e.size>1&&O.sortBoundaries(e);for(const t of e){if(!t._forceUpdate&&!t.component._lastState&&t.component.props===t._outerDef.props)continue;const e=t.host.services.updateBoundary(t);e&&(n=n.concat(e[0]),s=s.concat(e[1]))}return[n,s]}static shouldUpdateBy(n,s,o){var r,i,a;const d=n.component,l=n.host.settings.updateComponentModes,c=null===(r=d.constructor.api)||void 0===r?void 0:r.updateModes,u=s&&o?['props','state']:s?['props']:o?['state']:[];for(const n of u){const r=null!==(a=null!==(i=d.updateModes&&d.updateModes[n])&&void 0!==i?i:c&&c[n])&&void 0!==a?a:l[n],u='number'==typeof r?r:e[r]||0;if(u<-1){if(-2===u)return!0}else{if(0===u)return!0;if(!t.areEqual('state'===n?o:s,d[n],u))return!0}}return!1}callAndClear(e){const t=this[e];delete this[e];for(const e of t)e()}static callBoundariesBy(e){for(const t of e){const[e,n,s,o]=t,r=e.component,i='mounted'===n?'didMount':'moved'===n?'didMove':'didUpdate';r.signals[i]&&l(r.signals[i],'updated'===n?[s,o]:void 0)}}}class S{constructor(e,t){this.thruBoundary=e||null,this.sourceBoundary=t||null,this.envelope=null,this.truePassDef=null,this.groundedDefs=new Map,this.pendingDefs=new Set}hasContent(){var e;const t=null===(e=this.envelope)||void 0===e?void 0:e.applied;return!(!t||t.disabled||'fragment'===t.MIX_DOM_DEF&&(!t.childDefs.length||t.childDefs[0].disabled&&1===t.childDefs.length))}readContent(e=!1){if(!this.envelope)return null;const t=this.envelope.applied,n=t.childDefs;if('fragment'===t.MIX_DOM_DEF&&(!n.length||n[0].disabled&&1===n.length))return null;const s=this.envelope.target.childDefs;return e?s.slice():s}collectInterested(e){var t;if(e)return(null===(t=e.constructor.closure)||void 0===t?void 0:t.withContents)?new Set(e.constructor.closure.withContents):null;if(!this.withContents&&!this.chainedClosures)return null;const n=this.withContents?new Set(this.withContents):new Set;if(this.chainedClosures)for(const e of this.chainedClosures){const t=e.collectInterested();if(t)for(const e of t)n.add(e)}return n.size?n:null}contentGrounded(e,t,n,s){return this.groundedDefs.get(e)?'moved'===e.action&&n.boundary?[i.rootDOMTreeNodes(n.boundary.treeNode,!0,!0).map((e=>({treeNode:e,move:!0}))),[]]:[[],[]]:(this.groundedDefs.set(e,[t,n,s]),this.applyContentDefs([e]))}contentUngrounded(e){const t=this.groundedDefs.get(e);if(!t)return[[],[]];this.truePassDef===e&&(this.truePassDef=null),this.groundedDefs.delete(e),this.pendingDefs.delete(e);const n=t[1].boundary;return n?O.destroyBoundary(n):[[],[]]}preRefresh(e,t){if(this.stream&&this.stream.canRefresh())return this.envelope=e,this.stream.preRefresh(e);if(!this.envelope&&!e)return null;const n=this.collectInterested(t);if(n)for(const e of n)e._forceUpdate=e._forceUpdate||!0;return this.envelope=e,this.pendingDefs=new Set(this.groundedDefs.keys()),n}applyRefresh(e=!1){if(this.stream&&this.stream.canRefresh())return this.stream.applyRefresh(e);let t=[],n=[];return this.pendingDefs.size&&([t,n]=this.applyContentDefs(this.pendingDefs,e)),[t,n]}applyEnvelope(e){const t=this.preRefresh(e),n=t&&N.updateInterested(t),s=this.applyRefresh();return n?[n[0].concat(s[0]),n[1].concat(s[1])]:s}applyContentDefs(e,t=!1){e||(e=this.groundedDefs.keys());let n=[],s=[];for(const o of e){this.pendingDefs.delete(o);const e=this.groundedDefs.get(o);if(void 0===e)continue;let[r,i,a]=e,d=i.boundary;if(this.envelope&&this.sourceBoundary){let e=!0;const l=this.envelope;d?(e=this.truePassDef===o,d.updateEnvelope(l.target,e?l.applied:null)):(d=new Q(o,l.target,i,this.sourceBoundary),e=null==a&&(!this.truePassDef||this.truePassDef===o),e&&(d._innerDef.childDefs=l.applied.childDefs,this.truePassDef=o),d.parentBoundary=r,i.boundary=d);const[c,u]=e?O.runPassUpdate(d,t):O.runBoundaryUpdate(d,t);n=n.concat(c),s=s.concat(u)}else if(d){const e=O.destroyBoundary(d,!1);n=n.concat(e[0]),s=s.concat(e[1]),i.boundary=null}}return[n,s]}}class x extends p{constructor(){super(),this.components=new Set}update(e=!0,t,n){for(const s of this.components)s.triggerUpdate(e,t,n)}onListener(e,t,n){if(this.components.size){const s=this.signals[e][t],o=s[0];if(n)for(const t of this.components)t.listenTo(e,((...e)=>s[1]?o(t,...e,...s[1]):o(t,...e)),null,s[2],o);else for(const t of this.components)t.unlistenTo(e,o)}}}class w extends x{constructor(){super(),this.updateModes={props:'never'},this.builtProps=null}buildProps(){return this.onBuildProps?this.onBuildProps(this.builtProps):this.builtProps}getMixedProps(e){return this.onMixProps?this.onMixProps(e.props,this.builtProps,e):Object.assign(Object.assign({},e.props),e.state)}setProps(e,t,n,s){(this.builtProps!==e||t||void 0!==n||void 0!==s)&&(this.builtProps=e,this.update('trigger'!==t&&t,n,s))}refresh(e,t,n){this.setProps(this.buildProps(),e,t,n)}update(e=!0,t,n){for(const s of this.components)s.setState(this.getMixedProps(s),e,t,n)}}function I(...e){const t=e.length,n='string'==typeof e[t-1]?-1:0,s=e[t-3+n],r=e[t-2+n]||null,i=e[t-1+n],a=n?e[t-1]:i.name,d={[a]:(e,t)=>o(i,Object.assign({},t.state),le)}[a];return d.api=new w,s&&('object'==typeof s?d.api.builtProps=s:t>2&&'function'==typeof s&&(d.api.onBuildProps=s)),r&&(d.api.onMixProps=r),d}function T(e){return class extends e{constructor(e,...t){super(...t),this.dataListeners=new Map,this.dataKeysPending=null,this.data=e}listenToData(...e){let t=1;const n=e.length,s='boolean'==typeof e[n-t]&&e[n-t++],o=e[n-t],r=e.slice(0,n-t);this.dataListeners.set(o,r),s&&o(...r.map((e=>this.getInData(e))))}unlistenToData(e){return!!this.dataListeners.has(e)&&(this.dataListeners.delete(e),!0)}getData(){return this.data}getInData(e,t){if(!this.data)return t;if(!e)return this.data;const n=e.split('.');let s=this.data;for(const e of n){if(!s)return t;s=s[e]}return void 0===s?t:s}setData(e,t=!1,n=!0,...s){this.data=t&&this.data?Object.assign(Object.assign({},this.data),e):e,n?this.refreshData(!0,...s):this.addRefreshKeys(!0)}setInData(e,t,n=!1,s=!0,...o){if(this.data){if(e){const s=e.split('.'),o=s.pop();if(!o)return;let r=this.data;for(const e of s)r=r[e]||(r[e]={});if(n){const e=r[o];e&&e.constructor===Object?r[o]=Object.assign(Object.assign({},e),t):n=!1}n||(r[o]=t)}else this.data=n&&this.data?Object.assign(Object.assign({},this.data),t):t;s?this.refreshData(e||!0,...o):this.addRefreshKeys(e||!0)}}refreshData(e,t){if(e&&this.addRefreshKeys(e),null!=t)return void setTimeout((()=>this.refreshData(null)),t);const n=this.dataKeysPending;if(this.dataKeysPending=null,n)for(const[e,t]of this.dataListeners.entries())(!0===n||n.some((e=>t.some((t=>t===e||t.startsWith(e+'.')||e.startsWith(t+'.'))))))&&e(...t.map((e=>this.getInData(e))))}addRefreshKeys(e){if(!0===e)this.dataKeysPending=!0;else if(e&&!0!==this.dataKeysPending)if('string'==typeof e&&(e=[e]),this.dataKeysPending)for(const t of e)this.dataKeysPending.some((e=>e===t||t.startsWith(e+'.')))||this.dataKeysPending.push(t);else this.dataKeysPending=[...e]}}}const E=T;class A extends(T(Object)){}function R(e){return class extends(T(f(e))){}}const B=R;class L extends(R(Object)){}var F=(e,t,n,s)=>new(n||(n=Promise))(((o,r)=>{function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((e=>{e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}));class k extends L{constructor(e,t){super(e),this.contextAPIs=new Map,this.settings=k.getDefaultSettings(),this.refreshTimer=null,this._Signals=void 0,delete this._Signals,t&&this.modifySettings(t)}getListenersFor(e){let t=this.signals[e]||[];for(const[n,s]of this.contextAPIs)for(const o of s){const s=n.getListenersFor?n.getListenersFor(o,e):n.signals[o+'.'+e];s&&(t=t.concat(s))}return t[0]&&t}afterRefresh(e=!1,t){return new Promise((n=>F(this,void 0,void 0,(function*(){const s=e?'_afterRender':'_afterUpdate';this[s]||(this[s]=[]),this[s].push((()=>n())),this.triggerRefresh(t)}))))}refreshData(e,t){e&&this.addRefreshKeys(e),this.triggerRefresh(t)}triggerRefresh(e){this.refreshTimer=t.callWithTimeout(this,this.refreshPending,this.refreshTimer,this.settings.refreshTimeout,e)}refreshPending(){const e=this.dataKeysPending;let t=this._afterUpdate,n=this._afterRender;if(this.refreshTimer=null,this.dataKeysPending=null,delete this._afterUpdate,delete this._afterRender,t)for(const e of t)e();if(e){for(const[t,n]of this.dataListeners.entries())(!0===e||e.some((e=>n.some((t=>t===e||t.startsWith(e+'.')||e.startsWith(t+'.'))))))&&t(...n.map((e=>this.getInData(e))));for(const[t,n]of this.contextAPIs.entries())t.callDataListenersFor?t.callDataListenersFor(n,e):t.callDataBy(!0===e?n:n.map((t=>e.map((e=>t+'.'+e)))).reduce(((e,t)=>e.concat(t))))}n&&(()=>{F(this,void 0,void 0,(function*(){const e=[];for(const t of this.contextAPIs.keys())e.push(t.afterRefresh(!0));yield Promise.all(e);for(const e of n)e()}))})()}modifySettings(e){const t=k.getDefaultSettings();for(const n in e)e[n]=void 0===e[n]?t[n]:e[n]}static getDefaultSettings(){return{refreshTimeout:0}}}k.MIX_DOM_CLASS='Context';const j=(e,t)=>new k(e,t),U=(e,t)=>{const n={};for(const s in e)n[s]=j(e[s],t);return n};var X=(e,t,n,s)=>new(n||(n=Promise))(((o,r)=>{function i(e){try{d(s.next(e))}catch(e){r(e)}}function a(e){try{d(s.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((e=>{e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}));class W extends p{constructor(e){super(),this.contexts=Object.assign({},e),this.dataListeners=new Map}afterRefresh(e=!1,t){return new Promise((e=>X(this,void 0,void 0,(function*(){return e()}))))}sendSignal(e,...t){var n;const[s,o]=e.split('.',2);return null===(n=this.getContext(s))||void 0===n?void 0:n.sendSignal(o,...t)}sendSignalAs(e,t,...n){const[s,o]=t.split('.',2),r=this.getContext(s);if(r)return r.sendSignalAs(e,o,...n);const i='string'==typeof e?[e]:e,a=i.includes('last')||i.includes('first')||i.includes('first-true')?void 0:[];return i.includes('await')?new Promise((e=>e(a))):a}listenToData(...e){let t=1;const n=e.length,s='boolean'==typeof e[n-t]&&e[n-t++],o=Array.isArray(e[n-t])&&e[n-t++]||void 0,r=e[n-t],i=e.slice(0,n-t);this.dataListeners.set(r,[i,o]),s&&r(...this.getDataArgsBy(i,o))}unlistenToData(e){return!this.dataListeners.has(e)&&(this.dataListeners.delete(e),!0)}getInData(e,t){const n=e.split('.',1)[0],s=this.getContext(n);return s?s.getInData(e.slice(n.length+1),t):t}setInData(e,t,n,s,o){var r;const i=e.split('.',1)[0];null===(r=this.getContext(i))||void 0===r||r.setInData(e.slice(i.length+1),t,n,s,o)}refreshData(e,t){var n,s;const o={};for(const t of'string'==typeof e?[e]:e){const e=t.split('.',1)[0];void 0!==o[e]&&(o[e]=this.getContext(e)),null===(n=o[e])||void 0===n||n.addRefreshKeys(t.slice(e.length+1))}for(const e in o)null===(s=o[e])||void 0===s||s.refreshData(null,t)}refreshDataBy(e,t){const n=this.getContexts(e);for(const s in n){const o=n[s];o&&o.refreshData(e[s],t)}}getContext(e){return this.contexts[e]}getContexts(e){if(!e)return Object.assign({},this.contexts);const n=t.buildRecordable(e),s={};for(const e in this.contexts)n[e]&&(s[e]=this.contexts[e]);return s}newContext(e,t,n=!0){const s=j(e);return t&&this.setContext(t,s,n),s}newContexts(e,t=!1,n=!0){const s=U(e);return t&&this.setContexts(s,n),s}setContext(e,t,n=!0){const s=this.contexts[e];if(s===t)return!1;if(s){const t=s.contextAPIs.get(this);if(t){const n=t.filter((t=>t!==e));n.length?s.contextAPIs.set(this,n):s.contextAPIs.delete(this)}}if(t){const n=t.contextAPIs.get(this)||[];n.includes(e)||n.push(e),t.contextAPIs.set(this,n)}return void 0!==t?this.contexts[e]=t:delete this.contexts[e],n&&(this.callDataListenersFor?this.callDataListenersFor([e]):this.callDataBy([e])),!0}setContexts(e,t=!0){let n=!1;for(const t in e)n=this.setContext(t,e[t],!1)||n;return t&&n&&(this.callDataListenersFor?this.callDataListenersFor(Object.keys(e)):this.callDataBy(Object.keys(e))),n}getDataArgsBy(e,t){return e.map(((e,n)=>{const s=e.split('.',1)[0],o=this.getContext(s);return o?o.getInData(e.slice(s.length+1),t&&t[n]):t&&t[n]}))}callDataBy(e=!0){for(const[t,[n,s]]of this.dataListeners.entries())(!0===e||e.some((e=>n.some((t=>t===e||t.startsWith(e+'.')||e.startsWith(t+'.'))))))&&t(...this.getDataArgsBy(n,s))}}class H extends W{getContext(e,t=!0){return void 0!==this.contexts[e]?this.contexts[e]:t?this.host.contextAPI.contexts[e]:void 0}getContexts(e,t=!0){return t?Object.assign(Object.assign({},this.host.contextAPI.getContexts(e)),super.getContexts(e)):super.getContexts(e)}afterRefresh(e,t,n){return this.host.afterRefresh(e,t,n)}}function K(e){var n;return(n=class extends(f(e)){constructor(e,t,...n){super(...n),this.props=e,t&&(this.boundary=t,t.component=this)}initContextAPI(){if(this.contextAPI)return;this.contextAPI=new H,this.contextAPI.host=this.boundary.host,this.boundary.host.contextComponents.add(this);const e=this.boundary._outerDef.attachedContexts;if(e)for(const t in e)this.contextAPI.setContext(t,e[t],!1)}isMounted(){return!0===this.boundary.isMounted}getLastState(e=!0){return this._lastState||e&&this.state||null}getHost(){return this.boundary.host}queryElement(e,t=!1,n=!1){return i.domElementByQuery(this.boundary.treeNode,e,t,n)}queryElements(e,t=0,n=!1,s=!1){return i.domElementsByQuery(this.boundary.treeNode,e,t,n,s)}findElements(e=0,t=!1,n=!1,s){return i.treeNodesWithin(this.boundary.treeNode,{dom:!0},e,t,n,s).map((e=>e.domNode))}findComponents(e=0,t=!1,n=!1,s){return i.treeNodesWithin(this.boundary.treeNode,{boundary:!0},e,t,n,s).map((e=>e.boundary&&e.boundary.component))}findTreeNodes(e,n=0,s=!1,o=!1,r){return i.treeNodesWithin(this.boundary.treeNode,e&&t.buildRecordable(e),n,s,o,r)}newTimer(e,t){const n={};return this.setTimer(n,e,t),n}setTimer(e,t,n){this.timers?this.timers.has(e)&&this.clearTimer(e):this.timers=new Map,this.timers.set(e,setTimeout((()=>{this.clearTimer(e),t.call(this)}),n))}hasTimer(e){return!!this.timers&&this.timers.has(e)}clearTimer(e){if(!this.timers)return;const t=this.timers.get(e);null!=t&&(clearTimeout(t),this.timers.delete(e))}clearTimers(e){if(this.timers)if(e)for(const t of e)this.clearTimer(t);else this.timers.forEach((e=>clearTimeout(e))),this.timers.clear()}setUpdateModes(e,t=!0){t&&this.updateModes||(this.updateModes={});for(const t in e)this.updateModes[t]=e[t]}setConstantProps(e,t=!0,n=null){var s,o;t&&this.constantProps||(this.constantProps={});let r=!1;if(e)if(Array.isArray(e))for(const t of e)this.constantProps[t]=null===(s=(r=!0)&&n)||void 0===s||s;else for(const t in e)this.constantProps[t]=null!==(o=(r=!0)&&n)&&void 0!==o?o:e[t];r||t||delete this.constantProps}setState(e,t,n,s){this.boundary.updateBy({state:Object.assign(Object.assign({},this.state),e)},t,n,s)}setInState(e,t,n,s,o){this.boundary.updateBy({state:Object.assign(Object.assign({},this.state),{[e]:t})},n,s,o)}triggerUpdate(e,t,n){this.boundary.host.services.absorbUpdates(this.boundary,{force:e||!1},!0,t,n)}createWired(...e){const t=I(...e);return this.wired?this.wired.add(t):this.wired=new Set([t]),t}afterRefresh(e=!1,t,n){return this.boundary.host.afterRefresh(e,t,n)}render(e,t){return null}}).MIX_DOM_CLASS='Component',n}const q=K;class z extends(K(Object)){constructor(e,t,...n){super(e,t,...n)}}function G(e,t=e.name){return{[t]:e.length>1?(t,n,s)=>e(n,s):(t,n)=>e(n)}[t]}const Y=(e,t=e.name)=>({[t]:(t,n,s)=>e(n,s)}[t]);class V{constructor(e,t,n){this.host=e,this.treeNode=n,this._outerDef=t,this._innerDef=null,this.isMounted=!1,this.sourceBoundary=null,this.parentBoundary=null,this.innerBoundaries=[]}}class Q extends V{constructor(e,t,n,s){super(s.host,e,n),this.sourceBoundary=s,this.targetDef=t,this._innerDef=r.newAppliedDef(t,s.closure)}updateEnvelope(e,t){this.targetDef=e,t&&(this._innerDef.childDefs=t.childDefs)}}class Z extends V{constructor(e,t,n,s){super(e,t,n),this.bId=e.services.createBoundaryId(),this.sourceBoundary=s||null,this.closure=new S(this,s)}reattach(){this.component=null;const e=this._outerDef.props||{};let t=this._outerDef.tag;if('function'==typeof t){const n=t.api,s=t.MIX_DOM_CLASS?null:this._outerDef.tag,o=s&&s.length>=3||!1,r=this.component=new(s?n?{[s.name]:class extends z{}}[s.name]:z:t)(e,this);if(this.component=r,o&&r.initContextAPI(),s&&(r.render=o?e=>s.call(r,e,r,r.contextAPI):e=>s.call(r,e,r)),r.boundary||(r.boundary=this),n){r.constructor.api=n,n.components.add(r);for(const e in n.signals)for(const t of n.signals[e]){const[n,s,o]=t;r.listenTo(e,((...e)=>s?n(r,...e,...s):n(r,...e)),null,o,n)}}'Stream'===t.MIX_DOM_CLASS&&(this.closure.stream=r,t.addSource(r)),r.signals.preMount&&l(r.signals.preMount)}else this.component=new z(e,this)}update(e,t,n){this.host.services.absorbUpdates(this,{force:this.isMounted?e||!1:'all'},!0,t,n)}updateBy(e,t,n,s){this.host.services.absorbUpdates(this,Object.assign(Object.assign({},e),{force:this.isMounted?t||!1:'all'}),!0,n,s)}render(e=0){const t=!1===this.isMounted&&!this._renderState;e||(this._renderState='active');const n=this.component,s=n.render(n.props||{},n.state),o='function'==typeof s;if(o&&(n.render=s),t&&n.contextAPI&&n.contextAPI.callDataBy(),o)return this.render(e);if('re-updated'===this._renderState){const t=this.host.settings;if(t.maxReRenders<0||e<t.maxReRenders)return e++,this._renderState='active',this.render(e);t.devLogWarnings&&console.warn('__SourceBoundary.render: Warning: The component tried to render for over '+(e+1).toString()+' times.',this._outerDef.tag.MIX_DOM_CLASS?n.constructor:this._outerDef.tag,n)}return delete this._renderState,s}}class ${constructor(){this.hosts=new Set,this.contexts={}}}class J extends W{setContext(e,t,n=!0,s=!1){return s&&(t?this.host.shadowAPI.contexts[e]=t:delete this.host.shadowAPI.contexts[e]),super.setContext(e,t,n)}setContexts(e,t=!0,n=!1){if(n){const t=this.host.shadowAPI.contexts;for(const n in e)e[n]?t[n]=e[n]:delete t[n]}return super.setContexts(e,t)}afterRefresh(e,t,n){return this.host.afterRefresh(e,t,n)}getListenersFor(e,t){const n=e+'.'+t,s=(this.signals[n]||[]).concat([...this.host.contextComponents].filter((t=>t.contextAPI.signals[n]&&void 0===t.contextAPI.contexts[e])).map((e=>e.contextAPI.signals[n])).reduce(((e,t)=>e.concat(t)),[]));return s[0]&&s}callDataListenersFor(e,t=!0){const n=!0===t?e:e.map((e=>t.map((t=>e+'.'+t)))).reduce(((e,t)=>e.concat(t)));this.callDataBy(n);for(const t of this.host.contextComponents)e.some((e=>void 0===t.contextAPI.contexts[e]))&&t.contextAPI.callDataBy(n)}}class ee{constructor(e,t,n,s,o){this.constructor.idCount++,this.shadowAPI=o||new $,this.contextComponents=new Set,this.contextAPI=new J,this.contextAPI.host=this,s&&this.contextAPI.setContexts(s,!1,!0),this.groundedTree={type:'root',parent:null,children:[],domNode:t||null,sourceBoundary:null},this.settings=ee.getDefaultSettings(),n&&ee.modifySettings(this.settings,n),this.services=new N(this);const i=this.services.createRoot(e),a=r.newAppliedDef({MIX_DOM_DEF:'boundary',tag:i,props:{},childDefs:[]},null),d={type:'boundary',def:a,sourceBoundary:null,boundary:null,parent:this.groundedTree,children:[],domNode:null};this.groundedTree.children.push(d),this.rootBoundary=new Z(this,a,d),d.boundary=this.rootBoundary,this.rootBoundary.reattach(),this.services.absorbUpdates(this.rootBoundary,{})}clearRoot(e=!0,t,n){this.services.clearRoot(!0),e&&this.rootBoundary.update(!0,t,n)}moveRoot(e,t){if(this.groundedTree.domNode===e)return;this.groundedTree.domNode=e;const n=i.rootDOMTreeNodes(this.rootBoundary.treeNode,!0).map((e=>({treeNode:e,move:!0})));(n[0]||void 0!==t)&&this.services.absorbChanges(n,null,t)}updateRoot(e,t,n){this.services.updateRoot(e,t,n)}refreshRoot(e=!1,t,n){this.services.refreshRoot(e,t,n)}refreshDOM(e=!1,t){const n=!e||'read',s=[];let o,r=[...this.groundedTree.children],i=0;for(;o=r[i];)i+=1,o.domProps&&s.push({treeNode:o,refresh:n}),o.children[0]&&(r=o.children.concat(r.slice(i)),i=0);this.services.absorbChanges(s,null,t)}afterRefresh(e=!1,t,n){return new Promise((s=>this.afterRefreshCall(s,e,t,n)))}afterRefreshCall(e,t=!1,n,s){this.services.hasPending(!0,t)?(this.addRefreshCall(e,t),this.services.triggerUpdates(n,s)):e()}addRefreshCall(e,t=!1){const n=t?'_afterRender':'_afterUpdate';(this.services[n]||(this.services[n]=[])).push(e)}triggerRefresh(e,t){this.services.triggerUpdates(e,t)}pause(){this.services.renderer.pause()}resume(){this.services.renderer.resume()}isPaused(){return this.services.renderer.paused}rehydrate(e=null,t=!1,n=!1,s=!1,o,r){this.services.renderer.rehydrate(e||this.groundedTree.domNode,t,n,s,o,r)}rehydrateWith(e,t=null,n=!1,s=!1,o=!1,r,i){this.pause(),this.updateRoot(e,null,null),this.services.renderer.rehydrate(t||this.groundedTree.domNode,n,s,o,r,i)}readAsString(){return M.readAsString(this.rootBoundary.treeNode)}getRootElement(){return this.rootBoundary&&this.rootBoundary.treeNode.domNode}getRootElements(e){return this.rootBoundary?i.rootDOMTreeNodes(this.rootBoundary.treeNode,e,!1).map((e=>e.domNode)):[]}queryElement(e,t=!1){return i.domElementByQuery(this.groundedTree,e,!0,t)}queryElements(e,t=0,n=!1){return i.domElementsByQuery(this.groundedTree,e,t,!0,n)}findElements(e=0,t=!1,n){return i.treeNodesWithin(this.groundedTree,{dom:!0},e,!0,t,n).map((e=>e.domNode))}findComponents(e=0,t=!1,n){return i.treeNodesWithin(this.groundedTree,{boundary:!0},e,!0,t,n).map((e=>e.boundary&&e.boundary.component))}findTreeNodes(e,n=0,s=!1,o){return i.treeNodesWithin(this.groundedTree,e&&t.buildRecordable(e),n,!0,s,o)}modifySettings(e,t=!0){const n=this.settings.onlyRunInContainer;if(ee.modifySettings(this.settings,e),void 0!==e.onlyRunInContainer&&e.onlyRunInContainer!==n&&this.refreshRoot(!1,null,null),t)for(const t of this.shadowAPI.hosts)t!==this&&t.modifySettings(e,!1)}static modifySettings(e,t,n=!1){var s;let o=null;if(t.updateComponentModes){const e=t.updateComponentModes,n={};for(const t in e)n[t]=null!==(s=e[t])&&void 0!==s?s:(o||(o=ee.getDefaultSettings())).updateComponentModes[t];t=Object.assign(Object.assign({},t),{updateComponentModes:n})}for(const s in t)void 0!==t[s]?e[s]=t[s]:n&&(e[s]=(o||(o=ee.getDefaultSettings()))[s])}static getDefaultSettings(){return{updateTimeout:0,renderTimeout:0,useImmediateCalls:!1,updateComponentModes:{props:'shallow',state:'shallow'},preCompareDOMProps:'if-needed',wideKeysInArrays:!1,noRenderValuesMode:!1,onlyRunInContainer:!1,disableRendering:!1,duplicateDOMNodeBehaviour:'deep',duplicateDOMNodeHandler:null,duplicatableHost:!1,maxReRenders:1,renderTextTag:'',renderHTMLDefTag:'span',renderTextHandler:null,renderSVGNamespaceURI:'http://www.w3.org/2000/svg',renderDOMPropsOnSwap:!0,devLogWarnings:!1,devLogRenderInfos:!1}}}ee.MIX_DOM_CLASS='Host',ee.idCount=0;function te(...e){const t=e.length,n=!0===e[t-1],s=n||!e[t-1]?e.slice(0,t-1):e,o=(e,t,o)=>{let r=null;for(const n of s){if(!n)continue;const s=t.state,i=n(e,t,o);'function'!=typeof i&&'function'==typeof r||(r=i),s!==t.state&&t.state&&(t.state=Object.assign(Object.assign({},s||{}),t.state))}return n?()=>r:r};let r=!1;const i=s.filter((e=>(r=r||e.length>2,e.api))).map((e=>e.api)),a=r?(e,t,n)=>o(e,t,n):(e,t)=>o(e,t);return i[0]&&(a.api=function(e){const t=e.some((e=>e instanceof w))?new w:new x;for(const n of e){if(n.updateModes){t.updateModes||(t.updateModes={});for(const e in n.updateModes)t.updateModes[e]=Object.assign(Object.assign({},t.updateModes[e]),n.updateModes[e])}for(const e in n.signals)t.signals[e]=[...t.signals[e]||[],...n.signals[e]];n instanceof w&&(n.builtProps&&(t.builtProps=n.builtProps),n.onBuildProps&&(t.onBuildProps=n.onBuildProps),n.onMixProps&&(t.onMixProps=n.onMixProps))}return t}(i)),a}function ne(...e){const t=e[0].MIX_DOM_CLASS?e[0]:null;let n=t||z;for(const s of t?e.slice(1):e)n=s(n);return n}function se(e,...t){const n='function'!=typeof t[t.length-1]&&!!t.pop(),s=t.length>1?te(...t):t[0];return{[e.name]:class extends e{render(e){const t=s(e,this,this.contextAPI);return n?super.render:'function'==typeof t?t:()=>t}}}[e.name]}function oe(n){var s;return(s=class extends n{constructor(e,t,...n){super(...n),this.memory=t,this.onMount=e||null,this.onUnmount=null,this.depth=1}setDepth(t){this.depth=null==t?1:'string'==typeof t?e[t]:t}reset(e,t,n=!1){return this.use(t,n,e)}use(e,n=!1,s){const o=this.memory;if(this.depth<-1){if(-2!==this.depth)return!1}else if(!n&&t.areEqual(o,e,this.depth))return!1;return void 0!==s&&(this.onUnmount&&this.onUnmount(o,e,!1),this.onUnmount=null,this.onMount=s),this.memory=e,this.onMount&&(this.onUnmount=this.onMount(e,o)||null),!1}cancel(e=!0,t=!1,n=!1){const s=t?void 0:this.memory;e&&this.onUnmount&&this.onUnmount(this.memory,s,!0),this.memory=s,n&&(this.onMount=null,this.onUnmount=null)}}).MIX_DOM_CLASS='Memo',s}class re extends(oe(Object)){}const ie=oe,ae=(n,s,o=1)=>{let r,i=[];const a='string'==typeof o?e[o]:o;return(...e)=>{const o=n(...e);if(a<-1){if(-2!==a)return r}else if(t.areEqual(o,i,a))return r;return i=o,r=s(...i),r}};var de;const le=r.newContentPassDef(),ce=r.newContentPassDef({},!0),ue=e=>{var t;const n=null===(t=e.contentPass)||void 0===t?void 0:t.envelope;return n&&r.hasContentInDefs(n.applied.childDefs,ue)||!1},fe=((de=class extends z{hasContent(){var e;const t=null===(e=this.boundary.sourceBoundary)||void 0===e?void 0:e.closure;return t&&t.envelope&&r.hasContentInDefs(t.envelope.applied.childDefs,ue)||!1}render(){var e;return(null!==(e=this.props.hasContent)&&void 0!==e?e:this.hasContent())?le:null}})._WithContent=le,de),he={def:o,defHTML:(e,n,s,o)=>{const r={MIX_DOM_DEF:'content',tag:n||'',childDefs:[],domContent:e,domHTMLMode:!0};return n&&s&&(r.props=t.cleanDOMProps(s)),null!=o&&(r.key=o),r},Content:le,WithContent:fe,ContentCopy:ce,copyContent:r.newContentCopyDef,CompareDepthByMode:e,SignalMan:m,SignalManMixin:h,DataMan:A,DataManMixin:E,DataSignalMan:L,DataSignalManMixin:B,Component:z,ComponentMixin:q,Host:ee,Context:k,Ref:g,Memo:re,MemoMixin:ie,Fragment:b,Portal:v,Element:C,Empty:_,EmptyStream:P,newHost:(e,t,n,s)=>new ee(e,t,n,s),newContext:j,newContexts:U,newRef:()=>new g,newMemo:(e,t)=>new re(e,t),component:G,componentWith:Y,shadow:function(e,t,n=e.name){const s=e.MIX_DOM_CLASS?{[n]:class extends e{}}[n]:G(e,n);if(s.api=new x,t)for(const e in t)s.api.listenTo(e,t[e]);return s},shadowWith:(e,t,n=e.name)=>{const s=Y(e,n);if(s.api=new x,t)for(const e in t)s.api.listenTo(e,t[e]);return s},spread:e=>e.length>1?(t,...n)=>e(t,...n):e,spreadWith:e=>e.length>1?(t,...n)=>e(t,...n):e,stream:()=>{var e,t;return e=class e extends z{canRefresh(){return e.source===this}preRefresh(t){return e.source===this&&e.closure.preRefresh(t,this)||null}applyRefresh(t=!1){return e.source===this&&e.closure.applyRefresh(t)||[[],[]]}reattachSource(){return e.reattachSourceBy(this)}refreshSource(t){e.refreshStream(t)}render(){return null}static isStream(){return!0}static addSource(t){e.sources.add(t)}static removeSource(t,n=!0){if(e.sources.delete(t),e.source!==t)return null;let s=null;const o=e.closure.collectInterested(t);return s=e.closure.applyEnvelope(null),e.source=null,e.closure.sourceBoundary=null,(n||o)&&t.boundary.host.addRefreshCall((()=>{if(o)for(const e of o)e.host.services.absorbUpdates(e,{force:!0});n&&e.refreshStream()}),!0),s}static getBestStream(t=!0){var n;const s=e.sources,o=s.size;if(o<2)return o&&[...s][0]||null;let r=-1/0,i=null;for(const e of s){const t=e.boundary._outerDef.props.importance||0;t>r&&(i=e,r=t)}return t&&r===(null===(n=e.source)||void 0===n?void 0:n.boundary._outerDef.props).importance&&e.source||i}static reattachSourceBy(t){const n=e.source;if(n===t||(t.boundary._outerDef.props.importance||0)<=(n?n.boundary._outerDef.props.importance||0:-1/0))return null;let s=null;const o=t.boundary;return n&&(s=e.closure.applyEnvelope(null),s&&o.host!==n.boundary.host&&(n.boundary.host.services.absorbChanges(s[0],s[1],null),s=null)),e.source=t,e.closure.sourceBoundary=o,o.closure.envelope&&(s=O.mergeChanges(s,e.closure.applyEnvelope(o.closure.envelope))),s}static refreshStream(t){const n=e.getBestStream(),s=e.source||null;if(n===s)return;const o=e.closure,r=n?(s=!0)=>{const r=n.boundary;if(r.closure.envelope===o.envelope||s&&e.source!==n)return;e.source=n,o.sourceBoundary=r;const[i,a]=o.applyEnvelope(r.closure.envelope);(i[0]||a[0])&&r.host.services.absorbChanges(i,a,s?null:t)}:null;if(s){const i=s.boundary.host;let a=o.applyEnvelope(null);e.source=n,o.sourceBoundary=n&&n.boundary,a[0][0]||a[1][0]?(r&&i.addRefreshCall(r,!1),i.services.absorbChanges(a[0],a[1],t)):r&&r()}else r&&r(!1)}},e.MIX_DOM_CLASS='Stream',e.closure=new S,e.source=null,e.sources=new Set,e.Content=Object.assign(Object.assign({},r.newContentPassDef(e)),{contentPass:null,getStream:()=>e}),e.ContentCopy=Object.assign(Object.assign({},r.newContentPassDef(e,!0)),{contentPass:null,getStream:()=>e}),e.copyContent=t=>Object.assign(Object.assign({},r.newContentPassDef(null!=t?t:e,!0)),{contentPass:null,getStream:()=>e}),e.WithContent=((t=class extends z{render(){var t;return(null!=this.props.hasContent?this.props.hasContent:null===(t=e.source)||void 0===t?void 0:t.boundary.closure.hasContent())?le:null}})._WithContent=e.Content,t),e},wired:I,mixin:function(e){return e},mixFuncs:te,mixFuncsWith:function(...e){const t=e.length;return'function'!=typeof e[t-1]?te(...e.slice(0,t-1),!0):te(...e,!0)},mixClassFuncs:se,mixClassFuncsWith:function(...e){const t=e.length;return se(...'function'!=typeof e[t-1]?e.slice(0,t-1):e)},mixClassMixins:function(...e){return ne(...e)},mixMixins:ne,mixMixinsWith:function(...e){const t=e.length;return'function'!=typeof e[t-1]?ne(...e.slice(0,t-1)):ne(e)},mixHOCs:function(e,...t){let n=e;for(const e of t)n=e(n);return e=>o(n,e,le)},dataPicker:ae,dataSelector:(e,t,n=1)=>ae(((...t)=>e.map((e=>e&&e(...t)))),t,n),findTreeNodesIn:(e,n,s,o,r,a)=>i.treeNodesWithin(e,n&&t.buildRecordable(n),s,o,r,a),findComponentsIn:(e,t,n,s,o)=>i.treeNodesWithin(e,{boundary:!0},t,n,s,o).map((e=>e.boundary&&e.boundary.component)),findElementsIn:(e,t,n,s,o)=>i.treeNodesWithin(e,{dom:!0},t,n,s,o).map((e=>e.domNode)),queryElementIn:(e,t,n,s)=>i.domElementByQuery(e,t,n,s),queryElementsIn:(e,t,n,s,o)=>i.domElementsByQuery(e,t,n,s,o),readAsString:e=>{const t=e&&(e.constructor.MIX_DOM_CLASS?e.boundary.treeNode:e.treeNode||'string'==typeof e.type&&e);return t?M.readAsString(t):''},classNames:t.cleanDOMClass,parseStyle:t.cleanDOMStyle,areEqual:t.areEqual,deepCopy:t.deepCopy,range:t.range};window.MixDOM=he}();
